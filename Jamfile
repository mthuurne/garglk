#
# Include all the sub-projects
# Then make install rules to copy exe files into bin
#

SubDir TOP ;

SubInclude TOP garglk ;
SubInclude TOP terps ;
SubInclude TOP tads ;
SubInclude TOP support ;

SubDir TOP ;

BINDIR = [ FDirName $(TOP) build dist ] ;

for APP in $(APPS)
{
    LinkLibraries $(APP) : libgarglkmain ;
    SharedLinkLibraries $(APP) : libgarglk ;
    InstallBin $(BINDIR) : $(APP)$(SUFEXE) ;
}

if $(OS) = MINGW
{
    SubInclude TOP support ;
    SharedLinkLibraries scare : libz ;
    SharedLinkLibrariesOnSharedLibrary libgarglk :
        libfreetype libjpeg libpng libz ;

    InstallLib $(BINDIR) : libfreetype$(SUFDLL) ;
    InstallLib $(BINDIR) : libjpeg$(SUFDLL) ;
    InstallLib $(BINDIR) : libpng$(SUFDLL) ;
    InstallLib $(BINDIR) : libz$(SUFDLL) ;
}

InstallBin $(BINDIR) : gargoyle$(SUFEXE) ;
InstallLib $(BINDIR) : libgarglk$(SUFDLL) ;

if $(OS) = MINGW && $(USESDL)
{
    SharedLinkLibrariesOnSharedLibrary libgarglk : SDL_sound ;
    SEARCH_SOURCE = $(TOP)/support/sdl-1.2.13 ;
    InstallLib $(BINDIR) : SDL_sound.dll ;
    InstallLib $(BINDIR) : SDL_mixer.dll ;
    InstallLib $(BINDIR) : SDL.dll ;
    InstallLib $(BINDIR) : smpeg.dll ;
    InstallLib $(BINDIR) : libogg-0.dll ;
    InstallLib $(BINDIR) : libvorbis-0.dll ;
    InstallLib $(BINDIR) : libvorbisfile-3.dll ;
}

